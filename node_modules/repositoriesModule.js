var exec = require('child_process').exec;
var paths = require('paths.js');

//var gitCloneCommand = 'git clone';
var svnCheckoutCommand = 'svn checkout';
//var nameOfFolderWithProject = 'analyzedProjects';

//var locationOfFolderWithProjects = __dirname.replace('node_modules',nameOfFolderWithProject);
var locationOfFolderWithProjects = paths.locationOfFolderWithProjects();

exports.downloadRepo = function(properties,callback){

	console.log("lofwp : " + locationOfFolderWithProjects);
	var link = properties.link;
	var gitCommand = properties.gitCommand;
	console.log('-->receive link : ' + link );
	console.log('---->receive gitCommand : ' + gitCommand);
	
	if(contains(link, "git")){
		downloadFromVersionControl(gitCommand, link, callback);
	}else if(contains(link, "svn")){
		downloadFromVersionControl(svnCheckoutCommand, link, callback);
	}
	
}
  
function downloadFromVersionControl(command, link, callback){
	var options = {
		cwd : locationOfFolderWithProjects
	};

	exec([command,link].join(' '), options,
		function (error, stdout, stderr) {
			console.log("-->before callback with command : " + command);
			callback();
		});
}



exports.getNameOfRepo = function(link){
	var delimeter = '/';
	var splittedLink = link.split(delimeter);
	console.log(splittedLink);
	var indexOfLastElem = splittedLink.length - 1;
	console.log("indexOfLastElem : " + indexOfLastElem);

	if(splittedLink[indexOfLastElem] == '')
		return splittedLink[indexOfLastElem-1];	
	return splittedLink[indexOfLastElem];
}

function contains(path, expression){
	if(path.indexOf(expression) != -1) 
		return true;
	return false;

} 