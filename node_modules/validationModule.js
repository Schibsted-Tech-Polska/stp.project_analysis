var underscore = require('underscore');

exports.validateInput = function(properties, callback){
	var forbiddenCommands = [";", "|", "||", "&&","rm","cp","cat","ls","at","net","netstat","del","copy"];
	var gitCommandMustStartWith = ["git"];
	var javaBuildCommandMustStartWith = ["mvn","ant"];
	var safeGitCommand = 'git clone';

	if(!validateSpecyfic(properties.gitCommand,forbiddenCommands,underscore.contains)){
		console.log("---->validation of : " + properties.gitCommand + "FAILED");
		properties.gitCommand = safeGitCommand;
	}
	if(validateSpecyfic(properties.gitCommand,gitCommandMustStartWith,startsWith)){
		console.log("--->validation of : " + properties.gitCommand + "FAILED" )
		properties.gitCommand = safeGitCommand;
	}

	if(!validateSpecyfic(properties.javaBuildCommand,forbiddenCommands,underscore.contains)){
		console.log("--->validation of : " + properties.javaBuildCommand + "FAILED" )
		properties.javaBuildCommand = '';
	}

	if(validateSpecyfic(properties.javaBuildCommand,javaBuildCommandMustStartWith,startsWith)){
		console.log("--->validation of : " + properties.javaBuildCommand + "FAILED" )
		properties.javaBuildCommand = '';
	}

	console.log("--->after validation");	

	callback();
}

function validateSpecyfic(commandToValidate, forbiddenCommands,predicate){
	var result = true
	forbiddenCommands.map(function(currentCommand){
		if(predicate(commandToValidate,currentCommand)){
			console.log("bad validation");
			result =  false;
		}
	});	
	return result;
}

/*function startsWith(string, properStartCommands){	
	var result = false;
	properStartCommands.map(function(currentStartCommand){
		if(string.substring(0, currentStartCommand.length)  === currentStartCommand){
			result = true;
		}
	});
	return result;
}*/

function startsWith(string, properStartCommands){	
	var result = false;
	
		if(string.substring(0, properStartCommands.length)  === properStartCommands){
			result = true;
		}
	
	return result;
}
