var underscore = require('underscore');

exports.validateInput = function(properties, callback){
	//TODO 
	var forbiddenCommands = [";", "|", "||", "&&","rm","cp","cat","ls","at","net","netstat","del","copy"];
	var gitCommandMustStartWith = ["git"];
	var javaBuildCommandMustStartWith = ["mvn","ant"];
	var safeGitCommand = 'git clone';


	var v1 = validateSpecyfic(properties.gitCommand,forbiddenCommands,underscore.contains);
	v1(function(){
		properties.gitCommand = safeGitCommand;
	},function(){});//TODO assign to var DoNothing

	var v2 = validateSpecyfic(properties.gitCommand,gitCommandMustStartWith,startsWith);
	v2(function(){}
		,function(){
		properties.gitCommand = safeGitCommand;
	});

	var v3 = validateSpecyfic(properties.javaBuildCommand,forbiddenCommands,underscore.contains);
	v3(function(){
		properties.javaBuildCommand = '';
	},function(){});

	var v4=validateSpecyfic(properties.javaBuildCommand,javaBuildCommandMustStartWith,startsWith);	
	v4(function(){},function(){
		properties.javaBuildCommand = '';
	});

	var filesToOmitForbiddenCommands = [''];
	var v5 = validateSpecyfic(properties.filesToOmit, filesToOmitForbiddenCommands,isEqual);
	v5(function(){
		properties.filesToOmit = [];
	},function(){
		properties.filesToOmit = properties.filesToOmit.split(',');
	})
	
	console.log("--->after validation");	

	callback();
}


function validateSpecyfic(commandToValidate, forbiddenCommands,predicate){//TODO validate
	return function(actionWhenFail, actionWhenPass){
		var result = true;
		forbiddenCommands.map(function(currentCommand){
			if(predicate(commandToValidate,currentCommand)){
				console.log("bad validation");
				result =  false;
			}
		});	
		if(!result){
			console.log('validation of : ' + commandToValidate + " FAILED");
			actionWhenFail();
	  	}else{
	  		actionWhenPass();
	  	}

	}
}

function isEqual(firstArg, secondArg){
	return firstArg === secondArg;
}

function startsWith(string, properStartCommand){	
	console.log(string + " -> " + properStartCommand);
	var result = false;
	
		if(string.substring(0, properStartCommand.length)  === properStartCommand){
			result = true;
		}
	
	console.log("not start with : " + result)
	return result;
}




